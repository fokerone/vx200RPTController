# VX200 Controller

## üì° Sistema de Control para Repetidora Simplex v2.2.0

Sistema completo de control inteligente para repetidora simplex desarrollado en Node.js. Incluye decodificaci√≥n DTMF profesional con anti-falsos positivos, m√∫ltiples servicios automatizados, panel web moderno con navegaci√≥n por pesta√±as e integraci√≥n APRS completa con alertas meteorol√≥gicas SMN Argentina.

**üéâ Versi√≥n 2.2.0 - Sistema de Alertas Meteorol√≥gicas SMN Argentina**

---

## ‚ú® Caracter√≠sticas Principales

### üéµ **Sistema de Audio Avanzado**
- Grabaci√≥n en tiempo real con soporte ALSA/PulseAudio
- **Decodificador DTMF Profesional** con `dtmf-detection-stream`
- **Anti-falsos positivos** con detecci√≥n de voz integrada
- Configuraci√≥n de sensibilidad (Low/Medium/High)
- Modo debug para desarrollo y pruebas
- Roger Beep estilo Kenwood configurable

### üì° **Integraci√≥n APRS Completa**
- **TNC Software** integrado con Direwolf
- Transmisi√≥n de beacons autom√°ticos y manuales
- Recepci√≥n y tracking de estaciones
- **Mapa APRS interactivo** en tiempo real
- Configuraci√≥n din√°mica desde panel web
- Estad√≠sticas detalladas de tr√°fico APRS

### üåê **Panel Web Moderno v2.1**
- **Navegaci√≥n por pesta√±as** (Estado, DTMF, APRS, Configuraci√≥n)
- **Monitor DTMF en tiempo real** con historial
- **Dashboard APRS** con mapa y estad√≠sticas
- Controles de sensibilidad y debug DTMF
- Interfaz completamente **responsive**
- **Socket.IO** para actualizaciones en tiempo real

### üîä **Sistema de M√≥dulos**
- **Baliza Inteligente**: Transmisi√≥n autom√°tica/manual (`*9`)
- **DateTime**: Anuncio de fecha y hora (`*1`)
- **AI Chat**: Consultas con OpenAI GPT (`*2`)
- **SMS**: Mensajer√≠a con Twilio (`*3`)
- **Weather**: Informaci√≥n meteorol√≥gica (`*4` actual, `*5` voz)
- **üå¶Ô∏è Weather Alerts**: Sistema de alertas SMN Argentina (`*7` consultar, `*0` forzar verificaci√≥n)

### üå¶Ô∏è **Nuevo: Sistema de Alertas Meteorol√≥gicas SMN**
- **Monitoreo autom√°tico** cada 90 minutos de alertas SMN Argentina
- **Cobertura completa** de la provincia de Mendoza
- **Filtrado geogr√°fico inteligente** por coordenadas y pol√≠gonos CAP
- **Anuncios autom√°ticos** con Google TTS + fragmentaci√≥n para textos largos
- **Integraci√≥n APRS** con comentarios din√°micos incluyendo clima actual
- **Panel web actualizado** con estado en tiempo real de alertas activas
- **Repetici√≥n autom√°tica** cada 105 minutos para alertas vigentes

---

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos
- **Node.js** 18.x o superior
- **NPM** o Yarn
- **Sistema Linux** (probado en Arch Linux)
- **Hardware de audio** compatible con ALSA
- **Direwolf** (para funcionalidad APRS)

### Instalaci√≥n R√°pida

```bash
# Clonar el repositorio
git clone https://github.com/fokerone/vx200RPTController.git
cd vx200RPTController

# Instalar dependencias
npm install

# Configurar variables de entorno
cp .env.example .env
nano .env  # Editar configuraci√≥n

# Ejecutar el sistema
npm start
```

### Configuraci√≥n de Audio

```bash
# Verificar dispositivos disponibles
aplay -l
arecord -l

# Configurar en .env
AUDIO_DEVICE=default  # o hw:0,0 seg√∫n tu hardware
AUDIO_SAMPLE_RATE=48000
AUDIO_CHANNEL_THRESHOLD=0.02
```

### Configuraci√≥n APRS (Opcional)

```bash
# Instalar Direwolf
sudo pacman -S direwolf  # Arch Linux
sudo apt install direwolf  # Ubuntu/Debian

# Configurar TNC en .env
APRS_ENABLED=true
APRS_CALLSIGN=TU_INDICATIVO
APRS_LOCATION=lat,lon
```

**Panel web disponible en: http://localhost:3000**

---

## ‚öôÔ∏è Configuraci√≥n

### Variables de Entorno (.env)

```env
# Sistema
CALLSIGN=TU_INDICATIVO
NODE_ENV=production
WEB_PORT=3000

# Audio
AUDIO_DEVICE=default
AUDIO_SAMPLE_RATE=48000
AUDIO_CHANNEL_THRESHOLD=0.02

# TTS
TTS_VOICE=es+f3
TTS_SPEED=160

# Roger Beep
ROGER_BEEP_ENABLED=true
ROGER_BEEP_TYPE=kenwood
ROGER_BEEP_VOLUME=0.7

# Baliza
BALIZA_ENABLED=true
BALIZA_INTERVAL=60
BALIZA_MESSAGE=TU_INDICATIVO Repetidora Simplex

# APRS (Opcional)
APRS_ENABLED=true
APRS_CALLSIGN=YOSHUA
APRS_COMMENT=VX200 RPT
APRS_BEACON_INTERVAL=15

# APIs Opcionales
OPENWEATHER_API_KEY=tu_api_key
OPENAI_API_KEY=sk-...
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
```

---

## üéõÔ∏è Comandos DTMF

| Comando | Funci√≥n | Descripci√≥n |
|---------|---------|-------------|
| `*1` | DateTime | Anuncia fecha y hora actual |
| `*2` | AI Chat | Sistema de consultas con OpenAI |
| `*3` | SMS | Sistema de mensajes Twilio |
| `*4` | Weather | Clima actual |
| `*5` | Weather Voice | Clima con voz natural |
| `*7` | **üå¶Ô∏è Weather Alerts** | **Consultar alertas meteorol√≥gicas activas** |
| `*0` | **üîÑ Force Check** | **Forzar verificaci√≥n manual de alertas SMN** |
| `*9` | Baliza | Activa baliza manual |

---

## üìÅ Estructura del Proyecto

```
vx200RPTController/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.js                 # VX200Controller principal
‚îÇ   ‚îú‚îÄ‚îÄ constants.js             # Constantes del sistema
‚îÇ   ‚îú‚îÄ‚îÄ config/                  # Sistema de configuraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ logging/                 # Sistema de logging
‚îÇ   ‚îú‚îÄ‚îÄ audio/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audioManager.js      # Gestor de audio completo
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dtmfDecoder.js       # Decodificador DTMF profesional
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rogerBeep.js         # Roger Beep Kenwood
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ baliza.js            # M√≥dulo de baliza
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ datetime.js          # M√≥dulo fecha/hora
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aiChat.js            # M√≥dulo IA con OpenAI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sms.js               # M√≥dulo SMS con Twilio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ weather.js           # M√≥dulo meteorol√≥gico
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aprs.js              # M√≥dulo APRS con Direwolf
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îî‚îÄ‚îÄ server.js            # Servidor web con Socket.IO
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ index.html               # Panel web principal
‚îÇ   ‚îú‚îÄ‚îÄ aprs-map.html            # Mapa APRS interactivo
‚îÇ   ‚îú‚îÄ‚îÄ css/style.css            # Estilos modernos
‚îÇ   ‚îî‚îÄ‚îÄ js/app.js                # JavaScript frontend
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ default.json             # Configuraci√≥n por defecto
‚îú‚îÄ‚îÄ .env.example                 # Template de variables
‚îî‚îÄ‚îÄ README.md
```

---

## üñ•Ô∏è Panel Web v2.1

### **Navegaci√≥n por Pesta√±as**
- **üè† Estado del Sistema**: Overview general y control de m√≥dulos
- **üìû Monitor DTMF**: Seguimiento en tiempo real con estad√≠sticas
- **üì° APRS**: Dashboard completo con mapa y beacons
- **‚öôÔ∏è Configuraci√≥n**: Settings din√°micos del sistema

### **Funcionalidades Destacadas**
- **Monitor DTMF en Tiempo Real**: Historial, validaciones y debug
- **Dashboard APRS**: Mapa interactivo con estaciones activas
- **Estad√≠sticas Avanzadas**: M√©tricas de DTMF y APRS
- **Controles Din√°micos**: Sensibilidad DTMF, beacons APRS
- **Responsive Design**: Optimizado para m√≥viles y tablets

---

## üîß Scripts Disponibles

```bash
# Iniciar sistema completo
npm start

# Modo desarrollo con hot-reload
npm run dev

# Solo servidor web (testing)
npm run web-only

# Limpiar archivos temporales
npm run clean
```

---

## üõ†Ô∏è Caracter√≠sticas T√©cnicas v2.1

### **DTMF Profesional**
- **dtmf-detection-stream**: Librer√≠a especializada
- **Anti-falsos positivos**: Detecci√≥n de voz integrada
- **Configuraci√≥n avanzada**: 3 niveles de sensibilidad
- **Modo debug**: Para desarrollo y troubleshooting
- **Validaci√≥n temporal**: Evita detecciones err√≥neas

### **APRS Integration**
- **Direwolf TNC**: Software TNC completo
- **Beacon autom√°tico**: Transmisi√≥n programable
- **Position tracking**: Seguimiento de estaciones
- **Mapa en tiempo real**: Visualizaci√≥n web interactiva

### **Web Architecture**
- **Socket.IO**: Comunicaci√≥n bidireccional
- **Navegaci√≥n SPA**: Single Page Application
- **Cache DOM**: Optimizaci√≥n de rendimiento
- **Responsive CSS**: Grid y Flexbox moderno

---

## üêõ Troubleshooting

### Audio No Funciona
```bash
# Verificar dispositivos
aplay -l && arecord -l

# Permisos de audio
sudo usermod -a -G audio $USER

# Configurar device en .env
AUDIO_DEVICE=default
```

### DTMF No Detecta
```bash
# Verificar desde panel web:
# 1. Ir a pesta√±a "Monitor DTMF"
# 2. Activar "Modo Debug"
# 3. Cambiar sensibilidad a "Alta"
# 4. Verificar estad√≠sticas en tiempo real
```

### APRS No Conecta
```bash
# Verificar Direwolf
direwolf -t 0

# Verificar configuraci√≥n TNC
ps aux | grep direwolf
```

---

## üìã Changelog

### v2.2.0 - Sistema de Alertas Meteorol√≥gicas ‚ú®

#### üå¶Ô∏è **Nuevas Caracter√≠sticas**
- [x] **Sistema de Alertas Meteorol√≥gicas SMN** completo
  - [x] Monitoreo autom√°tico cada 90 minutos
  - [x] Cobertura completa provincia de Mendoza  
  - [x] Filtrado geogr√°fico por coordenadas y pol√≠gonos CAP
  - [x] Anuncios autom√°ticos con Google TTS + fragmentaci√≥n
  - [x] Comandos DTMF `*7` (consultar) y `*0` (forzar verificaci√≥n)
- [x] **Integraci√≥n APRS mejorada**
  - [x] Comentarios din√°micos con clima actual (temp, humedad, viento)
  - [x] Indicadores de alertas activas en beacon
  - [x] Actualizaci√≥n autom√°tica cada 15 minutos
- [x] **Panel web actualizado**
  - [x] Secci√≥n dedicada de alertas meteorol√≥gicas
  - [x] Estado del sistema en tiempo real 
  - [x] Contador de alertas activas
  - [x] Informaci√≥n de pr√≥ximas verificaciones

#### üêõ **Correcciones**
- [x] **Panel web**: Estado del sistema mostraba "--" 
- [x] **Panel web**: Pr√≥xima verificaci√≥n mostraba "--"
- [x] **Panel web**: Contador de alertas siempre mostraba "0"
- [x] **Audio**: Reproductores timeout mejorados para alertas largas (45s)
- [x] **TTS**: Fragmentaci√≥n autom√°tica para textos >200 caracteres
- [x] **Audio**: ffmpeg reemplaz√≥ sox para mejor compatibilidad MP3

### v2.1.1 - Panel Web Moderno

#### ‚úÖ Caracter√≠sticas Anteriores
- [x] **Panel web redise√±ado** con navegaci√≥n por pesta√±as
- [x] **Monitor DTMF profesional** con estad√≠sticas en tiempo real
- [x] **Dashboard APRS completo** con mapa interactivo
- [x] **Sistema de configuraci√≥n din√°mico**
- [x] **Controles de sensibilidad DTMF**

---

## üéØ Pr√≥ximas Versiones

### v2.3 - Planificado
- [ ] **M√©tricas avanzadas** del sistema
- [ ] **API REST completa** para integraciones
- [ ] **Backup autom√°tico** de configuraci√≥n
- [ ] **Alertas por m√∫ltiples provincias**

### v2.3 - Futuro
- [ ] **App m√≥vil nativa** con React Native
- [ ] **Integraci√≥n LoRa** para enlaces remotos
- [ ] **Machine Learning** para predicci√≥n de tr√°fico
- [ ] **Multi-repetidora** con sincronizaci√≥n

---

## üìû Soporte y Contacto

**Desarrollado por: LU5MCD**

- üìß **Email**: fokerone@gmail.com  
- üåê **GitHub**: https://github.com/fokerone/vx200RPTController
- üìª **QRZ**: https://www.qrz.com/db/LU5MCD

---

## üèÜ Reconocimientos

- **dtmf-detection-stream**: Excelente librer√≠a para detecci√≥n DTMF
- **Direwolf**: Software TNC indispensable para APRS
- **OpenAI**: Integraci√≥n de IA conversacional
- **Socket.IO**: Comunicaci√≥n en tiempo real

---

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver archivo `LICENSE` para m√°s detalles.

---

**‚ú® VX200 Controller v2.1.1 - Sistema de Repetidora Moderno y Profesional üì°üöÄ**